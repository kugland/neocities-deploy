---
agent: agent
model: Auto (copilot)
---
To publish a new release of this project, follow these steps:

1. `gh release list --json name,isDraft -q '.[] | select(.isDraft == true)'` to check if there are
   any existing draft releases.

2. You should see a draft release for the version in the workspaceâ€™s [Cargo.toml](../../Cargo.toml)
   file. If no draft release matches the version on `Cargo.toml`, tell the user he should first
   bump the version and create a draft release, and stop.

3. If a draft release exists, check that it contains all artifacts that are generated by the CI
   workflow.

    3.1. To list the artifacts that the CI should generate, run:

    ```console
    $ yq -r '.jobs.["test-and-build"].strategy.matrix.platform.[].name' < .github/workflows/ci.yml
    ```

    3.2. To check which artifacts are already available in the draft release, run:

    ```console
    $ gh release view vX.Y.Z --json assets -q '.assets | .[] | .name'
    ```

    3.3. Compare the list of expected artifacts with the list of available artifacts in the draft
    release and check if any artifact is missing. If any artifact is missing, tell the user to wait
    until the CI workflow has finished and stop.

4. Generate the notes for the release:

    4.1. Get the tags of the current and previous versions by running:

    ```console
    $ git tag | grep '^v' | sort -Vr | head -n2
    ```

    4.2. List the commits between the two tags by running:

    ```console
    $ git log --pretty=format:'*** %s' vPREVIOUS_VERSION..vCURRENT_VERSION
    ```

    4.3. If any of the commit messages is vague, check the commit diff to understand the changes.

    4.4. Using the information you just gathered, write the release notes in a clear and concise
    manner, highlighting the key changes, new features, bug fixes, and any other relevant
    information that would be useful for users of the release. Write it in Markdown format.
    Save the release notes in a temporary file.

5. Publish the release by running:

```console
$ gh release edit vX.Y.Z --draft=false --latest --notes-file=path/to/release-notes.txt
```
